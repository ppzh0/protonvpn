import{c as L}from"./createClient.BdOR7THN.js";import"./index.Bgw4UDry.js";const y=()=>crypto.randomUUID(),P=()=>{const t="v1.26.0+protonvpn-com-support".match(/^[vV](\d+)\.(\d+)\.(\d+)\+(.*)$/),e=t?`web-static-${t[4].replace("-","")}`:"web-static",r=t?`${t[1]}.${t[2]}.${t[3]}`:"0.0.0";return`${e}@${r}`},b=async(t,e)=>{const r=document?.referrer?{"X-PM-Referer":document.referrer}:{},a=e?.headers instanceof Headers?Object.fromEntries(e.headers.entries()):e?.headers||{};return fetch(t,{...e,credentials:"include",headers:{...a,...r,"Content-Type":"application/json;charset=utf-8",Accept:"application/vnd.protonmail.v1+json","x-pm-appversion":P()}})},C=t=>t.includes("/support")?"support_kb":t.includes("/blog")?"blog":t.includes("/legal/")?"legal":t.includes("/pricing")?"pricing":t.includes("/download")?"download":t.includes("/l/")?"landing_page":"other",I=()=>{const t=new Date().getTimezoneOffset(),e=t<=0?"+":"-",r=String(Math.floor(Math.abs(t)/60)).padStart(2,"0"),a=String(Math.abs(t)%60).padStart(2,"0");return`UTC${e}${r}:${a}`},V=()=>{const t={};return document.querySelectorAll('meta[name^="ab-test:"]').forEach(r=>{const a=r.getAttribute("name"),n=r.getAttribute("content");if(a&&n){const l=a.replace("ab-test:","");t[l]=n}}),t},M=t=>{if(!t)return;const e=t.getAttribute("aria-label");if(e)return g(e);const r=t.getAttribute("title");if(r)return g(r);const a=t.getAttribute("alt");if(a)return g(a);const n=t.getAttribute("name");if(n)return g(n);if((t instanceof HTMLInputElement||t instanceof HTMLButtonElement||t instanceof HTMLSelectElement)&&t.value)return g(t.value);const l=x(t);if(l&&l.textContent)return g(l.textContent.trim());const d=t.getAttribute("data-text");if(d)return g(d);if(t.tagName.toLowerCase()==="a"||t.tagName.toLowerCase()==="button"){const i=t.querySelector("img");if(i?.alt)return g(i.alt)}let u=Array.from(t.childNodes).filter(i=>i.nodeType===Node.TEXT_NODE).map(i=>i.textContent).join(" ").trim();if(!u&&(u=t.textContent?.trim()||"",u.includes("(function")||u.includes("window.localStorage")||u.includes("document.currentScript")||u.includes("addEventListener(")||u.includes("{")&&u.includes("}")&&u.includes(";"))){const i=u.split(/\(function|\{|\)|;/)[0].trim();return g(i||t.tagName.toLowerCase()+" element with JS code")}return g(u)},g=t=>t?t.substring(0,100):void 0;function x(t){let e=t.previousElementSibling;for(;e;){if(/^h[1-6]$/i.test(e.tagName))return e;e=e.previousElementSibling}const r=t.parentElement;if(r){const a=r.querySelector("h1, h2, h3, h4, h5, h6");if(a)return a}return null}const O=(t,e,r,a)=>{const n={pageStartTime:performance.now(),activeStartTime:document.hidden?null:performance.now(),totalActiveTime:0,isPageVisible:!document.hidden};function l(){n.pageStartTime=performance.now(),n.activeStartTime=document.hidden?null:n.pageStartTime,n.totalActiveTime=0,n.isPageVisible=!document.hidden}function d(){const o=performance.now();n.isPageVisible=!document.hidden,document.hidden?n.activeStartTime!==null&&(n.totalActiveTime+=o-n.activeStartTime,n.activeStartTime=null):n.activeStartTime=o}function u(){if(!a())return;const o=performance.now(),c=o-n.pageStartTime;n.isPageVisible&&n.activeStartTime!==null&&(n.totalActiveTime+=o-n.activeStartTime),t("exit",{timeOnPage:Math.round(c),activeTime:Math.round(n.totalActiveTime)})}function i(o){const c=o.target;if(!c)return;const f=typeof o.clientX=="number"?o.clientX:0,m=typeof o.clientY=="number"?o.clientY:0,p={elementType:c.tagName.toLowerCase(),elementId:c.id||void 0,elementText:M(c),elementHref:c.href||void 0,xPos:f,yPos:m};t("click",p)}function s(o){const c=o.target;if(!c)return;const f={formId:c.id||void 0,formAction:c.action||void 0,formFields:Array.from(c.elements).map(m=>m.name).filter(Boolean)};t("form_submit",f)}return document.addEventListener&&(document.addEventListener("visibilitychange",d),window.addEventListener("beforeunload",u),window.addEventListener("pagehide",u)),l(),{trackPageView:()=>{if(!r.pageView)return;n.pageStartTime&&n.totalActiveTime>0&&u(),l();const o={pageTitle:document.title,pageType:C(window.location.pathname),path:window.location.pathname,referrer:document.referrer};t("page_view",o,{features:V()})},initClickTracking:()=>{r.click&&document.addEventListener("click",i)},initFormTracking:()=>{r.form&&document.addEventListener("submit",s)},trackModalView:(o,c)=>{if(!r.modal)return;const f={modalId:o,modalType:c,timeToShow:Math.round(performance.now()-e)};t("modal_view",f)},destroy:()=>{document.removeEventListener("visibilitychange",d),window.removeEventListener("beforeunload",u),window.removeEventListener("pagehide",u),r.click&&document.removeEventListener("click",i),r.form&&document.removeEventListener("submit",s)}}};function N(t){return{initializeObserver:()=>{new PerformanceObserver(r=>{r.getEntries().forEach(a=>{if(a.entryType==="navigation"){const n=a,l={pageLoadTime:Math.round(n.loadEventEnd-n.startTime),dnsTime:Math.round(n.domainLookupEnd-n.domainLookupStart),tcpTime:Math.round(n.connectEnd-n.connectStart),ttfb:Math.round(n.responseStart-n.requestStart)};t("performance",l)}})}).observe({entryTypes:["navigation"]})}}}const _=t=>{const e={config:{debug:!1,dryRun:!1,appVersion:"0.1.0",events:{pageView:!0,click:!0,form:!1,performance:!0,visibility:!0,modal:!1},...t},anonymousId:"",pageLoadTime:0,userTimezone:"",userLanguage:"",isInitialized:!1,eventQueue:[],batchTimeout:null,BATCH_DELAY:200};function r(){const i=navigator.doNotTrack||window.doNotTrack,s=navigator.globalPrivacyControl,o=!(i==="1"||i==="yes"||s===!0);return!o&&localStorage.getItem("aId")&&localStorage.removeItem("aId"),o}async function a(i,s,o,c="high"){const f=n(i,s,o);return e.config.dryRun?(console.log("[DRY RUN] event:",f),!0):(e.eventQueue.push({event:f,priority:c}),e.batchTimeout&&clearTimeout(e.batchTimeout),new Promise(m=>{e.batchTimeout=setTimeout(async()=>{try{if(e.eventQueue.length===0){m(!0);return}if(!e.eventQueue.some(h=>h.priority==="high")){m(!0);return}const v={events:e.eventQueue.map(h=>h.event)},T=await b(e.config.endpoint,{method:"POST",body:JSON.stringify(v),keepalive:!0});T.ok&&(e.eventQueue=[]),m(T.ok)}catch(p){e.config.debug&&console.error("Analytics error:",p),m(!1)}},e.BATCH_DELAY)}))}function n(i,s,o){const c=new URLSearchParams(window.location.search),f={};c.forEach((E,A)=>{f[A]=E});const m=new Date,p=m.toISOString().replace("Z","+00:00"),v=-m.getTimezoneOffset(),T=Math.floor(Math.abs(v)/60).toString().padStart(2,"0"),h=(Math.abs(v)%60).toString().padStart(2,"0"),S=v>=0?"+":"-",k=new Date(m.getTime()-m.getTimezoneOffset()*6e4).toISOString().replace("Z",`${S}${T}:${h}`);return{anonymousId:e.anonymousId,messageId:y(),clientEventTimestampUtc:p,clientEventTimestampLocal:k,eventType:i,context:{campaign:{name:c.get("utm_campaign")||"",source:c.get("utm_source")||"",medium:c.get("utm_medium")||"",term:c.get("utm_term")||"",content:c.get("utm_content")||""},library:{name:"proton-analytics",version:e.config.appVersion},browserLocale:e.userLanguage,page:{title:document.title,url:window.location.href,path:window.location.pathname,referrer:document.referrer,queryString:window.location.search,queryParams:f},referrer:{type:"",name:"",url:document.referrer},screen:{width:window.screen.width,height:window.screen.height,density:Number(window.devicePixelRatio.toFixed(2))},timezone:e.userTimezone,userAgent:navigator.userAgent,features:o?.features||Object.create(null)},properties:{...s,data:o}}}function l(){const i="aId",s=localStorage.getItem(i);if(s)return e.anonymousId=s,s;const o=y();return localStorage.setItem(i,o),e.anonymousId=o,a("random_uid_created",{},void 0,"low"),o}r()&&(e.anonymousId=l(),e.pageLoadTime=performance.now(),e.userTimezone=I(),e.userLanguage=navigator.language||"en");const d=O(a,e.pageLoadTime,{pageView:!!e.config.events.pageView,click:!!e.config.events.click,form:!!e.config.events.form,performance:!!e.config.events.performance,visibility:!!e.config.events.visibility,modal:!!e.config.events.modal},r),u=N(a);return r()&&(e.config.events.pageView&&d.trackPageView(),e.config.events.click&&d.initClickTracking(),e.config.events.performance&&u.initializeObserver()),{trackPageView:()=>{r()&&d.trackPageView()},trackClicks:()=>{r()&&d.initClickTracking()},trackForms:()=>{r()&&d.initFormTracking()},trackModalView:(i,s)=>{r()&&d.trackModalView(i,s)},trackCustomEvent:(i,s,o)=>{r()&&a(i,s,o)},destroy:async()=>{if(e.batchTimeout&&clearTimeout(e.batchTimeout),e.eventQueue.length>0){const i={events:e.eventQueue.map(s=>s.event)};try{await b(e.config.endpoint,{method:"POST",body:JSON.stringify(i),keepalive:!0}),e.eventQueue=[]}catch(s){e.config.debug&&console.error("Analytics error:",s)}}d.destroy()}}},$=t=>{switch(t){case"protonvpn-com":return"https://telemetry.protonvpn.com/payload";case"lumo-proton-me":case"proton-me":default:return"https://telemetry.proton.me/payload"}},w=L(window.frameworkContext?.unleashApi||"https://account.proton.me/api");w.on("ready",()=>{if(w.getVariant("ProtonAnalyticsRollout")?.name==="B"){const{currentUrl:e}=window.frameworkContext??{};if(!e)return;const r=$("protonvpn-com"),a=_({endpoint:r,debug:!1,siteId:""});window.protonAnalytics=a}});w.start();
